# System Architecture Diagrams

## ğŸ“Š Database Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚
â”‚  (Clerk)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ owns (1:many)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Business   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Category   â”‚
â”‚             â”‚  many   â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  to     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚         many
       â”‚
       â”‚ has (1:many)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Location   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Professional â”‚
â”‚             â”‚  works  â”‚              â”‚
â”‚             â”‚   at    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚ has                    â”‚ offers
       â”‚ (1:many)               â”‚ (many:many)
       â”‚                        â”‚
       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Service   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ServProf     â”‚
â”‚             â”‚         â”‚ (junction)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ receives
       â”‚ (1:many)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Appointment    â”‚â”€â”€â”€â”€â”€â”€â–º Payment (many)
â”‚                 â”‚
â”‚  - PENDING      â”‚
â”‚  - PAYMENT_PEND â”‚
â”‚  - CONFIRMED    â”‚
â”‚  - CANCELLED    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Booking Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER     â”‚
â”‚ (Customer) â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Browse Directory                â”‚
â”‚     - Filter by category            â”‚
â”‚     - Search by name                â”‚
â”‚     - View ratings                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. View Business Page              â”‚
â”‚     - See all locations             â”‚
â”‚     - Browse services               â”‚
â”‚     - Read reviews                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Select Service                  â”‚
â”‚     - Choose location (if multiple) â”‚
â”‚     - Click "Reservar"              â”‚
â”‚     - Must login (Clerk)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Choose Date & Time              â”‚
â”‚     - Calendar shows available days â”‚
â”‚     - Time slots calculated         â”‚
â”‚     - Show conflicts if any         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Enter Details                   â”‚
â”‚     - Add notes (optional)          â”‚
â”‚     - Select professional (optional)â”‚
â”‚     - Review price + 1% fee         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Submit Request                  â”‚
â”‚     âœ… Appointment created          â”‚
â”‚     ğŸ“§ Email sent to business       â”‚
â”‚     Status: PENDING                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚
    â° Wait          â° Business
    2 hours           has 2h to
    max               respond
        â”‚                â”‚
        â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EXPIRED    â”‚   â”‚  BUSINESS ACTS  â”‚
â”‚  (timeout)  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚             â”‚            â”‚
â”‚ - Notify    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user      â”‚    â”‚                â”‚
â”‚ - Free slot â”‚    â–¼                â–¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚REJECTâ”‚      â”‚ APPROVE  â”‚
                 â””â”€â”€â”¬â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                    â”‚               â”‚
                    â–¼               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  REJECTED    â”‚  â”‚ PAYMENT_PENDINGâ”‚
            â”‚              â”‚  â”‚                â”‚
            â”‚ - Notify userâ”‚  â”‚ - Generate MP  â”‚
            â”‚ - Free slot  â”‚  â”‚   payment link â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ - Email user   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  USER PAYS     â”‚
                              â”‚  (MercadoPago) â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   CONFIRMED    â”‚
                              â”‚                â”‚
                              â”‚ - Lock slot    â”‚
                              â”‚ - Send confirm â”‚
                              â”‚ - Schedule     â”‚
                              â”‚   reminders    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’³ Payment Flow Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Business Approvesâ”‚
â”‚  Appointment     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Payment Preference  â”‚
â”‚  (MercadoPago SDK)          â”‚
â”‚                             â”‚
â”‚  - appointment details      â”‚
â”‚  - amount (service + 1%)    â”‚
â”‚  - user info                â”‚
â”‚  - callback URLs            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate Payment Link      â”‚
â”‚  https://mpago.la/xxxxx     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Email Link to User         â”‚
â”‚  "Complete tu pago"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚          â”‚
    â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PAYS   â”‚  â”‚ ABANDONS â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MercadoPago Processes      â”‚
â”‚  Payment                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Webhook Notification       â”‚
â”‚  â†’ /api/payments/webhook    â”‚
â”‚                             â”‚
â”‚  Payload:                   â”‚
â”‚  - payment_id               â”‚
â”‚  - status: "approved"       â”‚
â”‚  - merchant_order_id        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Database            â”‚
â”‚                             â”‚
â”‚  Appointment:               â”‚
â”‚    status â†’ CONFIRMED       â”‚
â”‚    paymentStatus â†’ PAID     â”‚
â”‚    confirmedAt â†’ now()      â”‚
â”‚                             â”‚
â”‚  Payment record:            â”‚
â”‚    CREATE new payment       â”‚
â”‚    - mercadoPagoId          â”‚
â”‚    - amount                 â”‚
â”‚    - platformFee (1%)       â”‚
â”‚    - netAmount (99%)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Send Confirmations         â”‚
â”‚                             â”‚
â”‚  User: "Pago confirmado"    â”‚
â”‚  Business: "Cita confirmada"â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Availability Calculation Logic

```
Input: Date, Service, Location
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Get Business Hours      â”‚
â”‚     for location + day      â”‚
â”‚                             â”‚
â”‚     e.g., Mon: 09:00-18:00  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Check Blocked Dates     â”‚
â”‚                             â”‚
â”‚     - Holidays              â”‚
â”‚     - Owner blocked         â”‚
â”‚     - Location closed       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Generate Time Slots     â”‚
â”‚                             â”‚
â”‚     serviceDuration = 60min â”‚
â”‚     bufferTime = 15min      â”‚
â”‚                             â”‚
â”‚     Slots:                  â”‚
â”‚     09:00-10:00             â”‚
â”‚     10:15-11:15             â”‚
â”‚     11:30-12:30             â”‚
â”‚     ... until 18:00         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Get Existing Bookings   â”‚
â”‚                             â”‚
â”‚     Status: CONFIRMED or    â”‚
â”‚             PAYMENT_PENDING â”‚
â”‚                             â”‚
â”‚     - 10:00-11:00 (booked)  â”‚
â”‚     - 14:00-15:00 (booked)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Filter Available        â”‚
â”‚                             â”‚
â”‚     Available:              â”‚
â”‚     âœ… 09:00-10:00          â”‚
â”‚     âŒ 10:15-11:15 (overlap)â”‚
â”‚     âœ… 11:30-12:30          â”‚
â”‚     âœ… 13:00-14:00          â”‚
â”‚     âŒ 14:15-15:15 (overlap)â”‚
â”‚     âœ… 15:30-16:30          â”‚
â”‚     âœ… 16:45-17:45          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Check Min Advance       â”‚
â”‚                             â”‚
â”‚     minAdvanceHours = 2     â”‚
â”‚     current time = 10:30    â”‚
â”‚                             â”‚
â”‚     Filter out:             â”‚
â”‚     âŒ 09:00 (past)         â”‚
â”‚     âŒ 11:30 (too soon)     â”‚
â”‚     âœ… 13:00 (OK)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. Return Available Slots  â”‚
â”‚                             â”‚
â”‚     [                       â”‚
â”‚       "13:00",              â”‚
â”‚       "15:30",              â”‚
â”‚       "16:45"               â”‚
â”‚     ]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¥ Multi-Location Professional Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Business            â”‚
â”‚  "Consultorio MÃ©dico"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ has locations
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚        â”‚        â”‚
    â–¼         â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Locationâ”‚ â”‚Locationâ”‚ â”‚Locationâ”‚
â”‚  A     â”‚ â”‚  B     â”‚ â”‚  C     â”‚
â”‚Centro  â”‚ â”‚Norte   â”‚ â”‚Sur     â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚          â”‚          â”‚
    â”‚          â”‚          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚          â”‚
         â”‚    works at on specific days
         â”‚          â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
    â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Professional â”‚     â”‚Professional â”‚
â”‚ Dr. Smith   â”‚     â”‚ Dr. Jones   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚
      â”‚                   â”‚
      â”‚ offers            â”‚ offers
      â”‚ services          â”‚ services
      â”‚                   â”‚
      â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProfessionalLocation Table  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dr. Smith â†’ Location A       â”‚
â”‚   Days: [MON, WED, FRI]      â”‚
â”‚                              â”‚
â”‚ Dr. Smith â†’ Location B       â”‚
â”‚   Days: [TUE, THU]           â”‚
â”‚                              â”‚
â”‚ Dr. Jones â†’ Location C       â”‚
â”‚   Days: [MON, TUE, WED]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User books "Consulta General" on Monday:
â†’ Can choose Dr. Smith at Location A
â†’ Or Dr. Jones at Location C

User books "Consulta General" on Tuesday:
â†’ Can choose Dr. Smith at Location B
â†’ Or Dr. Jones at Location C
```

---

## ğŸ“§ Notification Timeline

```
                    â”Œâ”€â”€â”€ Appointment Created â”€â”€â”€â”
                    â”‚      Status: PENDING      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    ğŸ“§ Email to Business
                    "Nueva solicitud de cita"
                    â° 2-hour countdown starts
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â–¼                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   APPROVED    â”‚          â”‚    REJECTED    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                           â”‚
        ğŸ“§ Email to User              ğŸ“§ Email to User
        "Solicitud aprobada"          "Solicitud rechazada"
        + Payment Link                + Reason
                    â”‚                           â”‚
                    â–¼                           END
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ User Pays MP  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        ğŸ“§ Email to Both
        "Pago confirmado"
        Status: CONFIRMED
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Appointment  â”‚
            â”‚     Date      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚
        -24 hours        -1 hour
            â”‚                â”‚
            â–¼                â–¼
    ğŸ“§ Reminder 24h    ğŸ“§ Reminder 1h
    "Recordatorio:      "Tu cita es
     MaÃ±ana a las       en 1 hora"
     10:00"
            â”‚                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Appointment  â”‚
            â”‚     Time      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            Mark as COMPLETED
            (manual or automatic)
                    â”‚
                    â–¼
            ğŸ“§ Email to User
            "Â¿CÃ³mo fue tu experiencia?"
            (Request review)
```

---

## ğŸ—ï¸ Component Architecture

```
app/
â”‚
â”œâ”€â”€ (public)/
â”‚   â”œâ”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Homepage
â”‚   â”‚   â”œâ”€â”€ <Hero />
â”‚   â”‚   â”œâ”€â”€ <CategoryGrid />
â”‚   â”‚   â”œâ”€â”€ <FeaturedBusinesses />
â”‚   â”‚   â””â”€â”€ <RecentNews />
â”‚   â”‚
â”‚   â”œâ”€â”€ directorio/
â”‚   â”‚   â”œâ”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Directory
â”‚   â”‚   â”‚   â”œâ”€â”€ <SearchBar />
â”‚   â”‚   â”‚   â”œâ”€â”€ <CategoryFilter />
â”‚   â”‚   â”‚   â”œâ”€â”€ <BusinessGrid />
â”‚   â”‚   â”‚   â””â”€â”€ <Pagination />
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ [slug]/
â”‚   â”‚       â”œâ”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Business Page
â”‚   â”‚       â”‚   â”œâ”€â”€ <BusinessHero />
â”‚   â”‚       â”‚   â”œâ”€â”€ <LocationSelector />
â”‚   â”‚       â”‚   â”œâ”€â”€ <ServiceList />
â”‚   â”‚       â”‚   â”œâ”€â”€ <ReviewsSection />
â”‚   â”‚       â”‚   â””â”€â”€ <ContactInfo />
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ reservar/[serviceId]/
â”‚   â”‚           â””â”€â”€ page.tsx â”€â”€â”€â”€â”€â–º Booking Flow
â”‚   â”‚               â”œâ”€â”€ <BookingCalendar />
â”‚   â”‚               â”œâ”€â”€ <TimeSlotPicker />
â”‚   â”‚               â”œâ”€â”€ <BookingForm />
â”‚   â”‚               â””â”€â”€ <BookingSummary />
â”‚   â”‚
â”‚   â””â”€â”€ noticias/
â”‚       â”œâ”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º News List
â”‚       â””â”€â”€ [slug]/page.tsx â”€â”€â”€â”€â”€â”€â–º News Post
â”‚
â”œâ”€â”€ (dashboard)/
â”‚   â”œâ”€â”€ panel/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º User Dashboard
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ <UpcomingAppointments />
â”‚   â”‚   â”‚   â””â”€â”€ <QuickActions />
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ citas/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚           â”œâ”€â”€ <AppointmentTable />
â”‚   â”‚           â””â”€â”€ <AppointmentFilters />
â”‚   â”‚
â”‚   â””â”€â”€ negocio/[id]/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Business Dashboard
â”‚       â”œâ”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ <StatsOverview />
â”‚       â”‚   â”œâ”€â”€ <PendingApprovals />
â”‚       â”‚   â””â”€â”€ <RecentActivity />
â”‚       â”‚
â”‚       â”œâ”€â”€ citas/
â”‚       â”‚   â””â”€â”€ page.tsx
â”‚       â”‚       â”œâ”€â”€ <AppointmentCalendar />
â”‚       â”‚       â”œâ”€â”€ <AppointmentList />
â”‚       â”‚       â””â”€â”€ <ApprovalQueue />
â”‚       â”‚
â”‚       â””â”€â”€ servicios/
â”‚           â””â”€â”€ page.tsx
â”‚               â”œâ”€â”€ <ServiceGrid />
â”‚               â””â”€â”€ <ServiceForm />
â”‚
â””â”€â”€ api/
    â”œâ”€â”€ appointments/
    â”‚   â”œâ”€â”€ route.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST: Create
    â”‚   â”œâ”€â”€ [id]/
    â”‚   â”‚   â”œâ”€â”€ route.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º GET, PUT, DELETE
    â”‚   â”‚   â”œâ”€â”€ approve/
    â”‚   â”‚   â”‚   â””â”€â”€ route.ts â”€â”€â”€â”€â”€â–º POST: Approve
    â”‚   â”‚   â””â”€â”€ reject/
    â”‚   â”‚       â””â”€â”€ route.ts â”€â”€â”€â”€â”€â–º POST: Reject
    â”‚   â”‚
    â”‚   â””â”€â”€ availability/
    â”‚       â””â”€â”€ route.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º GET: Check slots
    â”‚
    â””â”€â”€ payments/
        â”œâ”€â”€ create-preference/
        â”‚   â””â”€â”€ route.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST: Generate MP link
        â””â”€â”€ webhook/
            â””â”€â”€ route.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST: Handle MP webhook
```

---

## ğŸ”„ State Management Flow

```
Server Components (RSC)
        â”‚
        â”‚ fetch data
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Prisma DB      â”‚
â”‚   (PostgreSQL)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ returns data
        â”‚
        â–¼
Client Components
        â”‚
        â”‚ user actions
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Routes      â”‚
â”‚  (Next.js)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ mutations
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database        â”‚
â”‚  + Services      â”‚
â”‚  + Webhooks      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ triggers
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Notifications   â”‚
â”‚  - Email         â”‚
â”‚  - In-app        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

State Patterns:
- Server: Prisma queries in Server Components
- Client: React hooks for forms/UI
- No global state needed (use URL state)
- React Query for server state caching
```

---

This diagram-based documentation should help visualize how everything connects together!